---
import { getCollection, type CollectionEntry } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import SocialShare from '../../components/SocialShare.astro';
import { Image } from 'astro:assets';

export async function getStaticPaths() {
  const blogEntries = await getCollection('blog');
  return blogEntries.map(entry => ({
    params: { slug: entry.slug }, props: { entry },
  }));
}

interface Props {
  entry: CollectionEntry<'blog'>;
}

const { entry } = Astro.props;
const { Content } = await entry.render();

const url = new URL(Astro.url.pathname, Astro.site || 'http://localhost:4321').toString();

// Obtener posts recientes
const allPosts = await getCollection('blog');
const recentPosts = allPosts
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .filter(post => post.slug !== entry.slug)
  .slice(0, 3);

// Imagen de marcador de posición
const placeholderImage = '/placeholder.jpg';
---

<Layout 
  title={entry.data.title}
  description={entry.data.description || `Lee sobre ${entry.data.title} en nuestro blog.`}
>
  <article class="prose lg:prose-xl dark:prose-invert mx-auto mb-12">
    <h1>{entry.data.title}</h1>
    <p>Publicado el: {entry.data.pubDate.toLocaleDateString()}</p>
    {entry.data.image && (
      <Image 
        src={entry.data.image} 
        alt={entry.data.imageAlt || ''} 
        width={800} 
        height={400} 
        class="w-full h-auto rounded-lg shadow-md mb-6" 
      />
    )}
    <Content />
    <SocialShare url={url} title={entry.data.title} />
  </article>

  <section class="mb-12">
    <h2 class="text-2xl font-semibold mb-4 text-gray-800 dark:text-gray-200">Posts Recientes</h2>
    <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
      {recentPosts.map((post) => (
        <article class="bg-white dark:bg-gray-800 shadow-md rounded-lg overflow-hidden">
          <Image 
            src={post.data.image || placeholderImage}
            alt={post.data.imageAlt || 'Imagen del post'}
            width={400}
            height={200}
            class="w-full h-48 object-cover"
          />
          <div class="p-6">
            <h3 class="text-lg font-bold mb-2 text-gray-900 dark:text-gray-100">{post.data.title}</h3>
            <p class="text-gray-600 dark:text-gray-400 mb-4">{post.data.description}</p>
            <a href={`/blog/${post.slug}`} class="inline-block bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors">
              Leer más sobre {post.data.title}
            </a>
          </div>
        </article>
      ))}
    </div>
  </section>
</Layout>